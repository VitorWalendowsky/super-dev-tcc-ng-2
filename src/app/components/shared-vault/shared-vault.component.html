<div class="shared-vault-container">
  <!-- Header -->
  <div class="flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="m-0">Vault Compartilhado</h2>
      <p class="text-color-secondary m-0">Gerencie e compartilhe senhas com sua equipe</p>
    </div>
    <div class="flex gap-2">
      <button 
        pButton 
        label="Novo Compartilhamento" 
        icon="pi pi-share-alt"
        (click)="showShareDialog()">
      </button>
      <button 
        pButton 
        label="Criar Grupo" 
        icon="pi pi-users"
        class="p-button-outlined"
        (click)="showGroupDialog()">
      </button>
    </div>
  </div>

  <!-- Estatísticas -->
  <div class="grid mb-4">
    <div class="col-12 md:col-3" *ngFor="let stat of stats">
      <div class="stat-card">
        <div class="text-3xl font-bold text-primary">{{ stat.value }}</div>
        <div class="text-color-secondary">{{ stat.label }}</div>
      </div>
    </div>
  </div>

  <!-- Abas Simples -->
  <div class="tab-container">
    <div class="tab-header">
      <button 
        *ngFor="let tab of tabs" 
        class="tab-button"
        [class.active]="activeTab === tab.id"
        (click)="activeTab = tab.id">
        {{ tab.label }}
      </button>
    </div>

    <!-- Conteúdo das Abas -->
    <div class="tab-content">
      <!-- Aba Itens Compartilhados -->
      <div *ngIf="activeTab === 'items'" class="fade-in">
        <div class="flex justify-content-between align-items-center mb-3">
          <div class="flex gap-2">
            <select 
              class="p-inputtext w-12rem"
              [(ngModel)]="selectedFilter"
              (change)="filterItems()">
              <option value="all">Todos</option>
              <option value="password">Senhas</option>
              <option value="note">Notas</option>
              <option value="expiring">Expirando em breve</option>
            </select>
            
            <!-- Input Group Customizado -->
            <div class="custom-input-group">
              <span class="input-addon">
                <i class="pi pi-search"></i>
              </span>
              <input 
                type="text" 
                class="custom-input"
                placeholder="Buscar itens..." 
                [(ngModel)]="searchTerm"
                (input)="filterItems()">
            </div>
          </div>
          <button 
            pButton 
            label="Exportar Relatório" 
            icon="pi pi-download"
            class="p-button-outlined">
          </button>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Item</th>
                <th>Tipo</th>
                <th>Compartilhado Com</th>
                <th>Permissões</th>
                <th>Expira em</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of filteredSharedItems">
                <td>
                  <div class="flex align-items-center gap-2">
                    <i class="pi {{ item.icon }} text-color-secondary"></i>
                    <div>
                      <div class="font-medium">{{ item.title }}</div>
                      <small class="text-color-secondary">{{ item.description }}</small>
                    </div>
                  </div>
                </td>
                <td>
                  <span class="tag" [class]="'tag-' + item.type">
                    {{ item.type === 'password' ? 'Senha' : 'Nota' }}
                  </span>
                </td>
                <td>
                  <div class="flex align-items-center gap-2">
                    <div class="avatar-small">
                      {{ getInitials(item.sharedWith) }}
                    </div>
                    <span>{{ item.sharedWith }}</span>
                  </div>
                </td>
                <td>
                  <span class="tag" [class]="'tag-' + item.permission">
                    {{ getPermissionLabel(item.permission) }}
                  </span>
                </td>
                <td>
                  <span [class]="getExpirationClass(item.expiresAt)">
                    {{ getExpirationText(item.expiresAt) }}
                  </span>
                </td>
                <td>
                  <div class="flex gap-1">
                    <button 
                      pButton 
                      icon="pi pi-eye" 
                      class="p-button-text p-button-sm"
                      (click)="viewItem(item)">
                    </button>
                    <button 
                      pButton 
                      icon="pi pi-trash" 
                      class="p-button-text p-button-sm p-button-danger"
                      (click)="revokeAccess(item)">
                    </button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="filteredSharedItems.length === 0">
                <td colspan="6" class="text-center text-color-secondary p-4">
                  <i class="pi pi-share-alt text-4xl mb-2 block"></i>
                  Nenhum item compartilhado.
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Aba Grupos -->
      <div *ngIf="activeTab === 'groups'" class="fade-in">
        <div class="flex justify-content-between align-items-center mb-3">
          <h4 class="m-0">Grupos de Compartilhamento</h4>
          <button 
            pButton 
            label="Novo Grupo" 
            icon="pi pi-plus"
            (click)="showGroupDialog()">
          </button>
        </div>

        <div class="grid">
          <div class="col-12 md:col-4" *ngFor="let group of groups">
            <div class="group-card">
              <div class="flex justify-content-between align-items-start mb-3">
                <div>
                  <h4 class="m-0">{{ group.name }}</h4>
                  <small class="text-color-secondary">{{ group.members.length }} membros</small>
                </div>
                <div class="avatar-group">
                  <div 
                    *ngFor="let member of group.members.slice(0, 3)" 
                    class="avatar-small">
                    {{ getInitials(member.name) }}
                  </div>
                  <div 
                    *ngIf="group.members.length > 3" 
                    class="avatar-small avatar-more">
                    +{{ group.members.length - 3 }}
                  </div>
                </div>
              </div>
              
              <div class="border-top-1 surface-border my-3"></div>
              
              <div class="flex justify-content-between align-items-center">
                <small class="text-color-secondary">
                  {{ group.items.length }} itens compartilhados
                </small>
                <div class="flex gap-1">
                  <button 
                    pButton 
                    icon="pi pi-cog" 
                    class="p-button-text p-button-sm"
                    (click)="manageGroup(group)">
                  </button>
                  <button 
                    pButton 
                    icon="pi pi-trash" 
                    class="p-button-text p-button-sm p-button-danger"
                    (click)="deleteGroup(group)">
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Aba Solicitações -->
      <div *ngIf="activeTab === 'requests'" class="fade-in">
        <div class="grid">
          <div class="col-12 md:col-6" *ngFor="let request of accessRequests">
            <div class="group-card">
              <div class="flex justify-content-between align-items-start mb-3">
                <div class="flex align-items-center gap-3">
                  <div class="avatar-small" style="width: 3rem; height: 3rem;">
                    {{ getInitials(request.requester) }}
                  </div>
                  <div>
                    <h4 class="m-0">{{ request.requester }}</h4>
                    <small class="text-color-secondary">{{ request.requesterEmail }}</small>
                  </div>
                </div>
                <span class="tag" [class]="'tag-' + request.status">
                  {{ getRequestStatusLabel(request.status) }}
                </span>
              </div>
              
              <p class="mb-3">{{ request.message }}</p>
              
              <div class="border-top-1 surface-border my-3"></div>
              
              <div class="flex justify-content-between align-items-center">
                <small class="text-color-secondary">
                  Solicitado em {{ formatDate(request.requestedAt) }}
                </small>
                <div class="flex gap-1" *ngIf="request.status === 'pending'">
                  <button 
                    pButton 
                    label="Aprovar" 
                    icon="pi pi-check" 
                    class="p-button-success p-button-sm"
                    (click)="approveRequest(request)">
                  </button>
                  <button 
                    pButton 
                    label="Recusar" 
                    icon="pi pi-times" 
                    class="p-button-danger p-button-sm"
                    (click)="rejectRequest(request)">
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>