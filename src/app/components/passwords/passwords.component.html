<div class="p-4">
  <p-toast></p-toast>
  <div class="flex justify-content-between align-items-center mb-4">
    <h2>Gerenciador de Senhas</h2>
    <p-button 
      label="Nova Senha" 
      icon="pi pi-plus" 
      (onClick)="showNewPasswordDialog()">
    </p-button>
  </div>

  <p-card class="shadow-2">
    <p-table [value]="passwords" [paginator]="true" [rows]="10">
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 50px"></th>
          <th>Título</th>
          <th>Usuário/E-mail</th>
          <th>Website</th>
          <th>Categoria</th>
          <th>Ações</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-password>
        <tr>
          <!-- Coluna do Ícone -->
          <td>
            <i 
              [class]="password.icon || 'pi pi-globe'" 
              [style]="{'color': password.iconColor, 'font-size': '1.2rem'}">
            </i>
          </td>
          <td>{{ password.title }}</td>
          <td>
            <div class="flex align-items-center gap-2">
              <span>{{ password.username }}</span>
              <i 
                class="pi pi-copy cursor-pointer text-primary" 
                pTooltip="Copiar usuário"
                (click)="copyToClipboard(password.username, 'Usuário')">
              </i>
            </div>
          </td>
          <td>
            <a *ngIf="password.website" [href]="password.website" target="_blank" class="text-primary">
              {{ password.website }}
            </a>
            <span *ngIf="!password.website" class="text-color-secondary">-</span>
          </td>
          <td>
            <span class="p-tag">{{ password.category }}</span>
          </td>
          <td>
            <div class="flex gap-2">
              <p-button 
                icon="pi pi-pencil" 
                styleClass="p-button-rounded p-button-text"
                (onClick)="showEditPasswordDialog(password)">
              </p-button>
              <p-button 
                icon="pi pi-copy" 
                styleClass="p-button-rounded p-button-text"
                pTooltip="Copiar senha"
                (click)="copyToClipboard(password.password, 'Senha')">
              </p-button>
              <p-button 
                icon="pi pi-trash" 
                styleClass="p-button-rounded p-button-text p-button-danger"
                (onClick)="deletePassword(password)">
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center p-4">
            <i class="pi pi-inbox text-4xl text-color-secondary mb-2"></i>
            <p class="text-color-secondary">Nenhuma senha salva ainda.</p>
            <p-button 
              label="Adicionar Primeira Senha" 
              icon="pi pi-plus"
              (onClick)="showNewPasswordDialog()">
            </p-button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <!-- Diálogo Add/Edit -->
  <p-dialog 
    [(visible)]="displayDialog" 
    [style]="{width: '500px'}" 
    [header]="selectedPassword.id ? 'Editar Senha' : 'Nova Senha'"
    [modal]="true">
    
    <div class="p-fluid">
      <!-- Ícone e Título -->
      <div class="field mb-3">
        <div class="flex align-items-center gap-3">
          <i 
            [class]="selectedPassword.icon" 
            [style]="{'color': selectedPassword.iconColor, 'font-size': '1.5rem'}">
          </i>
          <input 
            id="title" 
            type="text" 
            pInputText 
            [(ngModel)]="selectedPassword.title" 
            placeholder="Título da senha"
            required
            class="w-full">
        </div>
      </div>

      <div class="field">
        <label for="username">Usuário/E-mail</label>
        <input id="username" type="text" pInputText [(ngModel)]="selectedPassword.username">
      </div>

      <div class="field">
        <label for="password">Senha</label>
        <div class="flex gap-2 align-items-center">
          <p-password 
            id="password" 
            [(ngModel)]="selectedPassword.password" 
            [toggleMask]="true"
            [feedback]="true"
            styleClass="w-full">
          </p-password>
          <app-password-generator 
            (passwordGenerated)="onPasswordGenerated($event)">
          </app-password-generator>
        </div>
      </div>

      <div class="field">
        <label for="website">Website</label>
        <div class="flex gap-2 align-items-center">
          <input 
            id="website" 
            type="url" 
            pInputText 
            [(ngModel)]="selectedPassword.website" 
            placeholder="https://"
            (input)="onWebsiteChange()"
            class="w-full">
        </div>
      </div>

      <div class="field">
        <label for="category">Categoria</label>
        <p-dropdown 
          [options]="categories" 
          [(ngModel)]="selectedPassword.category"
          placeholder="Selecione uma categoria">
        </p-dropdown>
      </div>

      <div class="field">
        <label for="notes">Notas</label>
        <textarea 
          id="notes" 
          pInputTextarea 
          [(ngModel)]="selectedPassword.notes" 
          [rows]="3"
          placeholder="Notas adicionais...">
        </textarea>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <p-button 
        label="Cancelar" 
        icon="pi pi-times" 
        styleClass="p-button-text"
        (onClick)="displayDialog = false">
      </p-button>
      <p-button 
        label="Salvar" 
        icon="pi pi-check" 
        (onClick)="savePassword()"
        [disabled]="!selectedPassword.title || !selectedPassword.password">
      </p-button>
    </ng-template>
  </p-dialog>
</div>