<div class="p-4">
  <p-toast></p-toast>
  <div class="flex justify-content-between align-items-center mb-4">
    <h2>Notas Seguras</h2>
    <p-button
      label="Nova Nota"
      icon="pi pi-plus"
      (onClick)="showNewNoteDialog()"
    >
    </p-button>
  </div>

  <div class="grid">
    <div class="col-12 md:col-6 lg:col-4" *ngFor="let note of notes">
      <p-card [header]="note.title" class="shadow-2 h-full note-card">
        <ng-template pTemplate="subtitle">
          <span class="p-tag">{{ note.category }}</span>
          <span class="text-color-secondary text-sm ml-2">
            <span class="text-color-secondary text-sm ml-2">
              {{ formatDate(note.updatedAt) }}
            </span>
          </span>
        </ng-template>

        <p class="line-clamp-3">{{ note.content }}</p>

        <ng-template pTemplate="footer">
          <div class="flex gap-2">
            <p-button
              icon="pi pi-pencil"
              label="Editar"
              styleClass="p-button-text p-button-sm"
              (onClick)="showEditNoteDialog(note)"
            >
            </p-button>
            <p-button
              icon="pi pi-trash"
              label="Excluir"
              styleClass="p-button-text p-button-sm p-button-danger"
              (onClick)="deleteNote(note)"
            >
            </p-button>
          </div>
        </ng-template>
      </p-card>
    </div>

    <div class="col-12" *ngIf="notes.length === 0">
      <p-card class="text-center shadow-2">
        <i class="pi pi-inbox text-4xl text-color-secondary mb-2"></i>
        <h3>Nenhuma nota salva</h3>
        <p class="text-color-secondary">
          Comece criando sua primeira nota segura.
        </p>
        <p-button
          label="Criar Primeira Nota"
          icon="pi pi-plus"
          (onClick)="showNewNoteDialog()"
          class="mt-3"
        >
        </p-button>
      </p-card>
    </div>
  </div>

  <!-- Add/Edit Dialog -->
  <p-dialog
    [(visible)]="displayDialog"
    [style]="{ width: '600px' }"
    [header]="selectedNote.id ? 'Editar Nota' : 'Nova Nota'"
    [modal]="true"
  >
    <div class="p-fluid">
      <div class="field">
        <label for="noteTitle">Título</label>
        <input
          id="noteTitle"
          type="text"
          pInputText
          [(ngModel)]="selectedNote.title"
          required
        />
      </div>

      <div class="field">
        <label for="noteCategory">Categoria</label>
        <p-dropdown
          [options]="categories"
          [(ngModel)]="selectedNote.category"
          placeholder="Selecione uma categoria"
        >
        </p-dropdown>
      </div>

      <div class="field">
        <label for="noteContent">Conteúdo</label>
        <textarea
          id="noteContent"
          pInputTextarea
          [(ngModel)]="selectedNote.content"
          [rows]="8"
          placeholder="Digite seu conteúdo aqui..."
          style="resize: vertical"
        >
        </textarea>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <p-button
        label="Cancelar"
        icon="pi pi-times"
        styleClass="p-button-text"
        (onClick)="displayDialog = false"
      >
      </p-button>
      <p-button
        label="Salvar"
        icon="pi pi-check"
        (onClick)="saveNote()"
        [disabled]="!selectedNote.title || !selectedNote.content"
      >
      </p-button>
    </ng-template>
  </p-dialog>
</div>
